<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>亚马逊关键词埋词查询工具 | 优化布局版</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f6f7fb;
            color: #2c3e50;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        
        h1 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .content {
            padding: 25px;
        }
        
        .input-area {
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.1rem;
            color: #2c3e50;
            margin-bottom: 12px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .textarea-container {
            position: relative;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 12px;
            border: 1px solid #dcdfe6;
            border-radius: 6px;
            resize: none;
            font-size: 0.95rem;
            margin-bottom: 10px;
            background-color: #fafbfc;
        }
        
        textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }
        
        .resize-handle {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 10px;
            background: #eaecef;
            cursor: ns-resize;
            border-radius: 0 0 6px 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .resize-handle::after {
            content: "";
            width: 30px;
            height: 3px;
            background: #bdc3c7;
            border-radius: 2px;
        }
        
        .resize-handle:hover {
            background: #d5dbdb;
        }
        
        .resize-handle:hover::after {
            background: #7f8c8d;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .check-btn {
            background: #3498db;
            color: white;
            flex: 1;
        }
        
        .check-btn:hover {
            background: #2980b9;
        }
        
        .reset-btn {
            background: #e74c3c;
            color: white;
        }
        
        .reset-btn:hover {
            background: #c0392b;
        }
        
        .input-reset-btn, .input-copy-btn {
            background: #ecf0f1;
            color: #7f8c8d;
            border: 1px solid #dcdfe6;
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            width: 100%;
            justify-content: center;
        }
        
        .input-reset-btn:hover, .input-copy-btn:hover {
            background: #e0e6e8;
            color: #2c3e50;
        }
        
        .input-copy-btn {
            background: #3498db;
            color: white;
        }
        
        .input-copy-btn:hover {
            background: #2980b9;
        }
        
        .input-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 150px;
        }
        
        .duplicate-warning {
            background: #ffebee;
            border-radius: 6px;
            padding: 12px 15px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #e74c3c;
            border: 1px solid #ffcdd2;
            display: none;
        }
        
        .duplicate-keyword {
            background: #ffcdd2;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
            font-weight: 500;
        }
        
        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaecef;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .modal-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            order: -1; /* 将统计信息移到最上方 */
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        .filter-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #eaecef;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }
        
        .filter-container label {
            margin-left: 8px;
            font-size: 0.9rem;
            color: #2c3e50;
            cursor: pointer;
        }
        
        .result-container-wrapper {
            position: relative;
            border: 1px solid #eaecef;
            border-radius: 6px;
            background: white;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.04);
            min-height: 150px;
            max-height: 500px;
            overflow: hidden;
        }
        
        .result-container {
            height: 300px;
            overflow-y: auto;
            padding: 15px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            background: white;
            border: 1px solid #f0f2f5;
            transition: all 0.2s;
        }
        
        .result-item:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
        }
        
        .phrase {
            font-weight: 500;
            flex: 1;
        }
        
        .status {
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            margin: 0 10px;
            min-width: 60px;
            text-align: center;
        }
        
        .true {
            background: #e8f5e9;
            color: #27ae60;
            border: 1px solid #c8e6c9;
        }
        
        .false {
            background: #ffebee;
            color: #e74c3c;
            border: 1px solid #ffcdd2;
        }
        
        .copy-btn {
            background: #f8f9fa;
            color: #3498db;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .copy-btn:hover {
            background: #e3f2fd;
            border-color: #3498db;
        }
        
        .copy-success {
            background: #e8f5e9;
            border-color: #27ae60;
            color: #27ae60;
        }
        
        .copy-all-btn {
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: auto;
        }
        
        .copy-all-btn:hover {
            background: #2980b9;
        }
        
        .summary-message {
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            padding: 10px;
            border-radius: 4px;
        }
        
        .success {
            background: #e8f5e9;
            color: #27ae60;
            border: 1px solid #c8e6c9;
        }
        
        .warning {
            background: #ffebee;
            color: #e74c3c;
            border: 1px solid #ffcdd2;
        }
        
        .low-rate {
            color: #e74c3c;
        }
        
        .no-results {
            text-align: center;
            color: #95a5a6;
            padding: 40px 20px;
            font-size: 0.95rem;
        }
        
        /* 新增样式：匹配率显示在标题右侧 */
        .match-rate-display {
            font-size: 1rem;
            font-weight: 500;
            margin-left: 15px;
            padding: 5px 12px;
            border-radius: 4px;
            background: #f8f9fa;
            border: 1px solid #eaecef;
        }
        
        .match-rate-success {
            background: #e8f5e9;
            color: #27ae60;
            border-color: #c8e6c9;
        }
        
        .match-rate-warning {
            background: #ffebee;
            color: #e74c3c;
            border-color: #ffcdd2;
        }
        
        @media (max-width: 600px) {
            .container {
                border-radius: 0;
                box-shadow: none;
            }
            
            body {
                padding: 0;
            }
            
            .content {
                padding: 15px;
            }
            
            .section-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .input-buttons {
                width: 100%;
                flex-direction: row;
            }
            
            .filter-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .copy-all-btn {
                margin-top: 10px;
                width: 100%;
                margin-left: 0;
            }
            
            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .result-item-actions {
                display: flex;
                width: 100%;
                justify-content: space-between;
            }
            
            .modal-content {
                margin: 0;
                width: 100%;
                height: 100%;
                max-height: 100%;
                border-radius: 0;
            }
            
            .modal-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .check-btn, .reset-btn {
                width: 100%;
            }
            
            /* 移动端适配：匹配率显示在标题下方 */
            .modal-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .match-rate-display {
                margin-left: 0;
                align-self: stretch;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>亚马逊关键词埋词查询工具</h1>
            <p>优化布局版 - 快速检测产品文案中是否包含所有关键词组</p>
        </header>
        
        <div class="content">
            <div class="input-area">
                <div class="section-title">
                    <span>关键词列表（每行一个或逗号分隔）</span>
                    <div class="input-buttons">
                        <button class="input-copy-btn" onclick="copyAllPhrases()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 5H6C4.89543 5 4 5.89543 4 7V19C4 20.1046 4.89543 21 6 21H16C17.1046 21 18 20.1046 18 19V18M8 5C8 4.46957 8.21071 3.96086 8.58579 3.58579C8.96086 3.21071 9.46957 3 10 3H14C14.5304 3 15.0391 3.21071 15.4142 3.58579C15.7893 3.96086 16 4.46957 16 5C16 5.53043 15.7893 6.03914 15.4142 6.41421C15.0391 6.78929 14.5304 7 14 7H10C9.46957 7 8.96086 6.78929 8.58579 6.41421C8.21071 6.03914 8 5.53043 8 5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            复制关键词
                        </button>
                        <button class="input-reset-btn" onclick="resetPhrases()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 6L18 18M6 18L18 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            重置关键词
                        </button>
                    </div>
                </div>
                <div class="textarea-container">
                    <textarea id="phrases" placeholder="请输入关键词组，可用逗号或换行分隔&#10;例如：&#10;Weihnachtsbaumspitze glänzend, Christbaumspitze Glas，Tannenbaum Spitze Glas&#10;Christbaumschmuck Spitze Glas,Christbaumspitze aus Glas für Weihnachten" oninput="checkDuplicates()"></textarea>
                    <div class="resize-handle" data-target="phrases"></div>
                </div>
                <div id="duplicate-warning" class="duplicate-warning"></div>
            </div>
            
            <div class="input-area">
                <div class="section-title">
                    <span>产品文案</span>
                    <div class="input-buttons">
                        <button class="input-copy-btn" onclick="copyContent()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 5H6C4.89543 5 4 5.89543 4 7V19C4 20.1046 4.89543 21 6 21H16C17.1046 21 18 20.1046 18 19V18M8 5C8 4.46957 8.21071 3.96086 8.58579 3.58579C8.96086 3.21071 9.46957 3 10 3H14C14.5304 3 15.0391 3.21071 15.4142 3.58579C15.7893 3.96086 16 4.46957 16 5C16 5.53043 15.7893 6.03914 15.4142 6.41421C15.0391 6.78929 14.5304 7 14 7H10C9.46957 7 8.96086 6.78929 8.58579 6.41421C8.21071 6.03914 8 5.53043 8 5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            复制文案
                        </button>
                        <button class="input-reset-btn" onclick="resetContent()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 6L18 18M6 18L18 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            重置文案
                        </button>
                    </div>
                </div>
                <div class="textarea-container">
                    <textarea id="content" placeholder="请输入要检查的产品文案内容&#10;例如：&#10;Weihnachtsbaumspitze Glänzend aus Glas – Edle 28cm Tannenbaumspitze für den Christbaum als traditioneller Baumschmuck für eine festliche & elegante Krönung"></textarea>
                    <div class="resize-handle" data-target="content"></div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="check-btn" onclick="checkPhrases()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 12L11 14L15 10M12 3C13.1819 3 14.3522 3.23279 15.4442 3.68508C16.5361 4.13738 17.5282 4.80031 18.364 5.63604C19.1997 6.47177 19.8626 7.46392 20.3149 8.55585C20.7672 9.64778 21 10.8181 21 12C21 13.1819 20.7672 14.3522 20.3149 15.4442C19.8626 16.5361 19.1997 17.5282 18.364 18.364C17.5282 19.1997 16.5361 19.8626 15.4442 20.3149C14.3522 20.7672 13.1819 21 12 21C10.8181 21 9.64778 20.7672 8.55585 20.3149C7.46392 19.8626 6.47177 19.1997 5.63604 18.364C4.80031 17.5282 4.13738 16.5361 3.68508 15.4442C3.23279 14.3522 3 13.1819 3 12C3 9.61305 3.94821 7.32387 5.63604 5.63604C7.32387 3.94821 9.61305 3 12 3Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    检查关键词
                </button>
                <button class="reset-btn" onclick="resetAll()">重置所有</button>
            </div>
        </div>
    </div>
    
    <!-- 结果弹窗 -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">检查结果</h2>
                <div id="match-rate-display" class="match-rate-display" style="display: none;"></div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <!-- 统计信息移到最上方 -->
            <div class="modal-stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-count">0</div>
                    <div class="stat-label">关键词总数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="matched-count">0</div>
                    <div class="stat-label">匹配数量</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="match-rate">0%</div>
                    <div class="stat-label">匹配率</div>
                </div>
            </div>
            
            <div class="filter-container">
                <div>
                    <input type="checkbox" id="hide-matched" onchange="toggleMatchedResults()" checked>
                    <label for="hide-matched">只显示未匹配的关键词</label>
                </div>
                <button class="copy-all-btn" onclick="copyAllUnmatched()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 5H6C4.89543 5 4 5.89543 4 7V19C4 20.1046 4.89543 21 6 21H16C17.1046 21 18 20.1046 18 19V18M8 5C8 4.46957 8.21071 3.96086 8.58579 3.58579C8.96086 3.21071 9.46957 3 10 3H14C14.5304 3 15.0391 3.21071 15.4142 3.58579C15.7893 3.96086 16 4.46957 16 5C16 5.53043 15.7893 6.03914 15.4142 6.41421C15.0391 6.78929 14.5304 7 14 7H10C9.46957 7 8.96086 6.78929 8.58579 6.41421C8.21071 6.03914 8 5.53043 8 5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    复制所有未匹配关键词
                </button>
            </div>
            
            <div class="result-container-wrapper">
                <div class="result-container" id="results">
                    <p class="no-results">请先输入关键词组和产品文案内容，然后点击"检查关键词"按钮</p>
                </div>
                <div class="resize-handle" data-target="results"></div>
            </div>
        </div>
    </div>
    
    <script>
        let lastResults = [];
        let lastMatchedCount = 0;
        let lastTotalCount = 0;
        let lastMatchRate = 0;
        
        // 初始化高度调整功能
        document.addEventListener('DOMContentLoaded', function() {
            initResizeHandles();
        });
        
        function initResizeHandles() {
            const resizeHandles = document.querySelectorAll('.resize-handle');
            
            resizeHandles.forEach(handle => {
                let isResizing = false;
                let startY, startHeight;
                
                handle.addEventListener('mousedown', startResize);
                handle.addEventListener('touchstart', startResizeTouch, { passive: false });
                
                function startResize(e) {
                    isResizing = true;
                    startY = e.clientY;
                    const targetId = handle.getAttribute('data-target');
                    const target = targetId === 'results' ? 
                        document.querySelector('.result-container') : 
                        document.getElementById(targetId);
                    startHeight = parseInt(getComputedStyle(target).height, 10);
                    document.addEventListener('mousemove', resize);
                    document.addEventListener('mouseup', stopResize);
                    e.preventDefault();
                }
                
                function startResizeTouch(e) {
                    isResizing = true;
                    startY = e.touches[0].clientY;
                    const targetId = handle.getAttribute('data-target');
                    const target = targetId === 'results' ? 
                        document.querySelector('.result-container') : 
                        document.getElementById(targetId);
                    startHeight = parseInt(getComputedStyle(target).height, 10);
                    document.addEventListener('touchmove', resizeTouch, { passive: false });
                    document.addEventListener('touchend', stopResize);
                    e.preventDefault();
                }
                
                function resize(e) {
                    if (!isResizing) return;
                    
                    const targetId = handle.getAttribute('data-target');
                    const target = targetId === 'results' ? 
                        document.querySelector('.result-container') : 
                        document.getElementById(targetId);
                    
                    const height = startHeight + (e.clientY - startY);
                    const minHeight = 150;
                    const maxHeight = targetId === 'results' ? 500 : 400;
                    
                    if (height > minHeight && height < maxHeight) {
                        target.style.height = `${height}px`;
                    }
                }
                
                function resizeTouch(e) {
                    if (!isResizing) return;
                    
                    const targetId = handle.getAttribute('data-target');
                    const target = targetId === 'results' ? 
                        document.querySelector('.result-container') : 
                        document.getElementById(targetId);
                    
                    const height = startHeight + (e.touches[0].clientY - startY);
                    const minHeight = 150;
                    const maxHeight = targetId === 'results' ? 500 : 400;
                    
                    if (height > minHeight && height < maxHeight) {
                        target.style.height = `${height}px`;
                    }
                    
                    e.preventDefault();
                }
                
                function stopResize() {
                    isResizing = false;
                    document.removeEventListener('mousemove', resize);
                    document.removeEventListener('touchmove', resizeTouch);
                }
            });
        }
        
        function normalizeText(text) {
            let normalized = text.toLowerCase();
            normalized = normalized.replace(/ {2,}/g, ' ');
            return normalized;
        }
        
        function checkDuplicates() {
            const phrasesInput = document.getElementById('phrases').value.trim();
            const warningContainer = document.getElementById('duplicate-warning');
            
            if (!phrasesInput) {
                warningContainer.style.display = 'none';
                return;
            }
            
            let phrases = [];
            const lines = phrasesInput.split('\n');
            
            lines.forEach(line => {
                const commaSeparated = line.split(/[,，]/);
                commaSeparated.forEach(item => {
                    const trimmed = item.trim();
                    if (trimmed) {
                        phrases.push(trimmed);
                    }
                });
            });
            
            const duplicates = findDuplicates(phrases);
            
            if (duplicates.length > 0) {
                let warningHTML = '检测到重复关键词：';
                duplicates.forEach(phrase => {
                    warningHTML += `<span class="duplicate-keyword">${phrase}</span>`;
                });
                warningContainer.innerHTML = warningHTML;
                warningContainer.style.display = 'block';
            } else {
                warningContainer.style.display = 'none';
            }
        }
        
        function findDuplicates(phrases) {
            const seen = {};
            const duplicates = [];
            
            phrases.forEach(phrase => {
                const normalized = normalizeText(phrase);
                if (seen[normalized]) {
                    if (!duplicates.includes(phrase)) {
                        duplicates.push(phrase);
                    }
                } else {
                    seen[normalized] = true;
                }
            });
            
            return duplicates;
        }
        
        // 复制所有关键词组
        function copyAllPhrases() {
            const phrasesInput = document.getElementById('phrases').value.trim();
            
            if (!phrasesInput) {
                alert('关键词组为空，无法复制');
                return;
            }
            
            const textArea = document.createElement('textarea');
            textArea.value = phrasesInput;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                
                // 显示复制成功反馈
                const copyBtn = document.querySelectorAll('.input-copy-btn')[0];
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '已复制';
                copyBtn.style.background = '#27ae60';
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '#3498db';
                }, 2000);
            } catch (err) {
                console.error('复制失败:', err);
                alert('复制失败，请手动选择并复制文本');
            }
            
            document.body.removeChild(textArea);
        }
        
        // 复制文案内容
        function copyContent() {
            const contentInput = document.getElementById('content').value.trim();
            
            if (!contentInput) {
                alert('产品文案内容为空，无法复制');
                return;
            }
            
            const textArea = document.createElement('textarea');
            textArea.value = contentInput;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                
                // 显示复制成功反馈
                const copyBtn = document.querySelectorAll('.input-copy-btn')[1];
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '已复制';
                copyBtn.style.background = '#27ae60';
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '#3498db';
                }, 2000);
            } catch (err) {
                console.error('复制失败:', err);
                alert('复制失败，请手动选择并复制文本');
            }
            
            document.body.removeChild(textArea);
        }
        
        function checkPhrases() {
            const phrasesInput = document.getElementById('phrases').value.trim();
            const contentInput = document.getElementById('content').value.trim();
            const resultsContainer = document.getElementById('results');
            const totalCountEl = document.getElementById('total-count');
            const matchedCountEl = document.getElementById('matched-count');
            const matchRateEl = document.getElementById('match-rate');
            const matchRateDisplay = document.getElementById('match-rate-display');
            
            if (!phrasesInput || !contentInput) {
                alert('请先输入关键词组和产品文案内容');
                return;
            }
            
            let phrases = [];
            const lines = phrasesInput.split('\n');
            
            lines.forEach(line => {
                const commaSeparated = line.split(/[,，]/);
                commaSeparated.forEach(item => {
                    const trimmed = item.trim();
                    if (trimmed) {
                        phrases.push(trimmed);
                    }
                });
            });
            
            if (phrases.length === 0) {
                resultsContainer.innerHTML = '<p class="no-results">未检测到有效的关键词组</p>';
                resetStats();
                return;
            }
            
            // 去重处理
            const uniquePhrases = [];
            const seen = {};
            
            phrases.forEach(phrase => {
                const normalized = normalizeText(phrase);
                if (!seen[normalized]) {
                    seen[normalized] = true;
                    uniquePhrases.push(phrase);
                }
            });
            
            totalCountEl.textContent = uniquePhrases.length;
            lastTotalCount = uniquePhrases.length;
            
            const normalizedContent = normalizeText(contentInput);
            let matchedCount = 0;
            lastResults = [];
            
            uniquePhrases.forEach(phrase => {
                if (phrase) {
                    const normalizedPhrase = normalizeText(phrase);
                    const found = normalizedContent.includes(normalizedPhrase);
                    
                    if (found) matchedCount++;
                    
                    lastResults.push({
                        phrase: phrase,
                        found: found
                    });
                }
            });
            
            matchedCountEl.textContent = matchedCount;
            lastMatchedCount = matchedCount;
            lastMatchRate = (matchedCount / uniquePhrases.length * 100);
            const matchRateText = lastMatchRate.toFixed(2);
            matchRateEl.textContent = `${matchRateText}%`;
            
            if (lastMatchRate < 80) {
                matchRateEl.classList.add('low-rate');
            } else {
                matchRateEl.classList.remove('low-rate');
            }
            
            // 更新标题右侧的匹配率显示
            if (lastMatchedCount === lastTotalCount) {
                matchRateDisplay.textContent = `所有关键词组都已找到！匹配率：${matchRateText}%`;
                matchRateDisplay.className = 'match-rate-display match-rate-success';
            } else {
                matchRateDisplay.textContent = `部分关键词组未找到！匹配率：${matchRateText}%`;
                matchRateDisplay.className = 'match-rate-display match-rate-warning';
            }
            matchRateDisplay.style.display = 'block';
            
            renderResults();
            openModal();
        }
        
        function renderResults() {
            const resultsContainer = document.getElementById('results');
            const hideMatched = document.getElementById('hide-matched').checked;
            
            if (lastResults.length === 0) {
                resultsContainer.innerHTML = '<p class="no-results">请先输入关键词组和产品文案内容，然后点击"检查关键词"按钮</p>';
                return;
            }
            
            let resultsHTML = '';
            let displayedCount = 0;
            
            lastResults.forEach(result => {
                if (hideMatched && result.found) {
                    return;
                }
                
                const isMobile = window.innerWidth <= 600;
                
                if (isMobile) {
                    resultsHTML += `
                        <div class="result-item">
                            <span class="phrase">${result.phrase}</span>
                            <div class="result-item-actions">
                                <span class="status ${result.found ? 'true' : 'false'}">
                                    ${result.found ? '已匹配' : '未匹配'}
                                </span>
                                <button class="copy-btn" onclick="copyKeyword('${result.phrase.replace(/'/g, "\\'")}')">复制</button>
                            </div>
                        </div>
                    `;
                } else {
                    resultsHTML += `
                        <div class="result-item">
                            <span class="phrase">${result.phrase}</span>
                            <span class="status ${result.found ? 'true' : 'false'}">
                                ${result.found ? '已匹配' : '未匹配'}
                            </span>
                            <button class="copy-btn" onclick="copyKeyword('${result.phrase.replace(/'/g, "\\'")}')">复制</button>
                        </div>
                    `;
                }
                
                displayedCount++;
            });
            
            if (displayedCount === 0 && hideMatched) {
                resultsHTML = '<p class="no-results">所有关键词都已匹配！</p>';
            }
            
            resultsContainer.innerHTML = resultsHTML;
        }
        
        function toggleMatchedResults() {
            renderResults();
        }
        
        function resetStats() {
            document.getElementById('total-count').textContent = '0';
            document.getElementById('matched-count').textContent = '0';
            document.getElementById('match-rate').textContent = '0%';
            document.getElementById('match-rate').classList.remove('low-rate');
            document.getElementById('match-rate-display').style.display = 'none';
            lastResults = [];
            lastMatchedCount = 0;
            lastTotalCount = 0;
            lastMatchRate = 0;
        }
        
        function resetContent() {
            document.getElementById('content').value = '';
            document.getElementById('hide-matched').checked = true;
            document.getElementById('results').innerHTML = '<p class="no-results">请先输入关键词组和产品文案内容，然后点击"检查关键词"按钮</p>';
            resetStats();
        }
        
        function resetPhrases() {
            document.getElementById('phrases').value = '';
            document.getElementById('duplicate-warning').style.display = 'none';
            document.getElementById('hide-matched').checked = true;
            document.getElementById('results').innerHTML = '<p class="no-results">请先输入关键词组和产品文案内容，然后点击"检查关键词"按钮</p>';
            resetStats();
        }
        
        function resetAll() {
            resetPhrases();
            resetContent();
        }
        
        function copyKeyword(keyword) {
            const textArea = document.createElement('textarea');
            textArea.value = keyword;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                
                const buttons = document.querySelectorAll('.copy-btn');
                buttons.forEach(btn => {
                    if (btn.textContent === '复制' && btn.previousElementSibling.previousElementSibling.textContent === keyword) {
                        btn.textContent = '已复制';
                        btn.classList.add('copy-success');
                        
                        setTimeout(() => {
                            btn.textContent = '复制';
                            btn.classList.remove('copy-success');
                        }, 2000);
                    }
                });
            } catch (err) {
                console.error('复制失败:', err);
            }
            
            document.body.removeChild(textArea);
        }
        
        function copyAllUnmatched() {
            const unmatchedPhrases = [];
            
            lastResults.forEach(result => {
                if (!result.found) {
                    unmatchedPhrases.push(result.phrase);
                }
            });
            
            if (unmatchedPhrases.length === 0) {
                alert('没有未匹配的关键词');
                return;
            }
            
            const textToCopy = unmatchedPhrases.join('\n');
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                
                const copyBtn = document.querySelector('.copy-all-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '已复制';
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            } catch (err) {
                console.error('复制失败:', err);
            }
            
            document.body.removeChild(textArea);
        }
        
        function openModal() {
            document.getElementById('resultModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }
        
        // 点击弹窗外部关闭弹窗
        window.onclick = function(event) {
            const modal = document.getElementById('resultModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
